<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>情侣飞行棋 💖🧩</title>
<style>
body { font-family: sans-serif; margin:0; padding:20px; background:#fff0f5; display:flex; flex-direction:column; align-items:center;}
h1 { color:#ff69b4; text-align:center;}
#gameContainer { display:flex; gap:20px; flex-wrap:wrap; justify-content:center; }
#board { display:grid; grid-template-columns:repeat(10,40px); grid-gap:2px; }
.cell { width:40px; height:40px; border:1px solid #ccc; display:flex; justify-content:center; align-items:center; position:relative; font-size:12px; border-radius:4px; background:#ffe6f0; }
.heart { width:30px; height:30px; border-radius:50%; display:flex; justify-content:center; align-items:center; color:white; font-weight:bold; position:absolute; top:5px; left:5px; transition: transform 0.3s ease; }
.player1 { background-color:#ff69b4; }
.player2 { background-color:#87cefa; }
#contentList { max-height:420px; overflow-y:auto; width:220px; background:white; border-radius:5px; padding:5px; box-shadow:1px 1px 5px rgba(0,0,0,0.1); }
#contentList div { padding:2px 5px; font-size:12px; color:#333; display:none; }
#contentList div.active { display:block; background:#ffb6c1; border-radius:3px; }
button { padding:8px 16px; margin:5px; border:none; border-radius:5px; background:#ff69b4; color:white; cursor:pointer; }
#dice { font-size:30px; margin:10px; font-weight:bold; transition: transform 0.2s ease; display:inline-block; }
#playerNames { margin-bottom:10px; text-align:center; }
input { padding:4px 6px; margin:0 5px; border-radius:4px; border:1px solid #ccc; }
</style>
</head>
<body>

<h1>情侣飞行棋 💖🧩<br>ល្បែងហ្គេមហោះគូស្នេហ៍</h1>

<div id="playerNames">
玩家1昵称: <input id="name1" placeholder="💖Ta1">
玩家2昵称: <input id="name2" placeholder="💙Ta2">
<button id="startBtn">开始游戏 / ចាប់ផ្តើមហ្គេម</button>
</div>

<div id="gameContainer">
  <div id="board"></div>
  <div id="contentList"></div>
</div>

<div>
<button id="rollBtn" disabled>掷骰子 🎲 / ដាក់គ្រាប់ចាញ់ 🎲</button>
<div id="dice">🎲</div>
<div id="status"></div>
</div>

<script>
const boardSize = 100;
const board = document.getElementById('board');
const contentList = document.getElementById('contentList');
const status = document.getElementById('status');
const diceEl = document.getElementById('dice');
const rollBtn = document.getElementById('rollBtn');
const startBtn = document.getElementById('startBtn');

let playerPos = [0,0];
let currentPlayer = 0;
let playerNames = ["玩家1","玩家2"];
let moving = false;
let safetyTimer = null; // 防卡死补丁

// 特殊格子
const specialCells = {
  5: {type:'kiss', text:'亲亲+2 💏 / ប៉ះ +2 💏', move:2},
  12:{type:'home', text:'回家-1 🏠 / ត្រឡប់-1 🏠', move:-1},
  23:{type:'kiss', text:'亲亲+2 💏 / ប៉ះ +2 💏', move:2},
  37:{type:'home', text:'回家-1 🏠 / ត្រឡប់-1 🏠', move:-1},
  50:{type:'kiss', text:'亲亲+2 💏 / ប៉ះ +2 💏', move:2},
  70:{type:'home', text:'回家-1 🏠 / ត្រឡប់-1 🏠', move:-1},
  85:{type:'kiss', text:'亲亲+2 💏 / ប៉ះ +2 💏', move:2}
};

// 浪漫互动模板（你的内容）
let cellContents = [
"脱掉两件衣服🌸 / ដោះខោអាវពីរ💖",
"亲对方手 ✋ / ថើបដៃគូរបស់អ្នក ✋",
"甜蜜拥抱 🤗 / ក្បាលស្និទ្ធ 🤗",
"舌吻30秒 💏 / ថើបដោយអណ្តាត ៣០ វិនាទី 💏",
"互相看眼睛30s 👀 / មើលភ្នែកគ្នា30s 👀",
"随机脱一件对方的衣服 🎁 / ដោះសម្លៀកបំពាក់មួយឈុតរបស់គូស្នេហ៍ដោយចៃដន្យ 🎁",
"公主抱30秒 🍽️ / គូស្នេហ៍បែបព្រះនាង ៣០ វិនាទី 🍽️",
"深情亲吻对方胸口 30 秒 🚶‍♂️🚶‍♀️ / ស្និទ្ធស្នាលលើទ្រូងគូរបស់អ្នក ៣០ វិនាទី 🚶‍♂️🚶‍♀️",
"给对方喂水（嘴对嘴） 🎵 / ផឹកទឹកជាមួយគូរបស់អ្នក តាមមាត់តី 🎵",
"亲吻对方下体30秒 🎬 / មេត្តាជូបផ្នែកខាងក្រោមនៃរាងកាយរបស់អ្នកដទៃ ៣០ វិនាទី 🎬",
"打对方三下屁股 🍫 / ដាក់ដៃបីដងលើខ្នងខាងក្រោយរបស់មិត្តភក្តិ 💖",
"亲亲+2 💏 / ប៉ះ +2 💏",
"抱起对方亲吻30秒 🚴 / កាប់គូរបស់អ្នកឡើងហើយបង្រួមប吻រយៈពេល ៣០ វិនាទី 🚴",
"观看性爱视频，并进行10分钟的性爱 🌇 / មើលវីដេអូភេទរួមគ្នា ហើយធ្វើសេចក្តីស្នេហ៍រយៈពេល ១០ នាទី 🌇",
"回家-1 🏠 / ត្រឡប់-1 🏠",
"亲吻对方脖子到胸口 🐱 / លីកកករ និងទ្រូងរបស់ម្នាក់រយៈ ៣០ វិនាទី 🐱",
"脱掉两件衣服 🐶 / ដកអាវពីរ 🐶",
"想办法让对方下体流水 🏖️ / រកវិធីដើម្បីធ្វើឱ្យចំណង់ផ្លូវភេទរបស់មនុស្សផ្សេងទៀតហូរចេញពីរាងកាយខាងក្រោម 🏖️",
"给对方按摩1分钟 🎈 / អ្នកប្រគល់ម៉ាស្សាទៅអ្នករយៈពេល ១ នាទី 🎈",
"亲亲+2 💏 / ប៉ះ +2 💏",
"互相舔对方下体1分钟 🌅 / លិបរាងកាយផ្នែកខាងក្រោមរបស់គ្នាទៅវិញទៅមករយៈពេល 1 នាទី 🌅",
"休息一分钟 📚 / សម្រាក 1 នាទី 📚",
"回家-1 🏠 / ត្រឡប់-1 🏠",
"跳舞30秒 💃 / រាំ ៣០ វិនាទី 💃",
"女生用脚和对方发生性行为 🎡 / ស្រ្តីប្រើជើងរបស់ខ្លួនឲ្យមនុស្សម្នាក់ទទួលការទាក់ទងផ្លូវភេទ 🎡",
"温馨拥抱30s 🤗 / ក្បាលស្និទ្ធ 30s 🤗",
"和对方一起洗澡 🎨 / ងូតទឹកជាមួយនរណាម្នាក់ 🎨",
"亲亲+2 💏 / ប៉ះ +2 💏",
"骑在对方身上30s 🐎 / ជិះលើរាងកាយអ្នកដទៃរយៈពេល ៣០ វិនាទី 🐎",
"一分钟比赛任何事情 🛹 / ប្រកួតប្រជែងគ្នា ១ នាទី 🛹",
"再来一次 ✨ / ម្តងទៀត ✨",
"停止行动30秒 🎁 / បញ្ឈប់សកម្មភាព ៣០ វិនាទី 🎁",
"亲亲+2 💏 / ប៉ះ +2 💏",
"让对方高潮 ☕ / ធ្វើឱ្យម្នាក់ទទួលបានកំពូលសេចក្តីសុខ ☕",
"亲吻对方屁股30秒 ✈️ / ហែលទឹកបារីរបស់គ្នាទៅរយៈពេល ៣០ វិនាទី ✈️",
"回家-1 🏠 / ត្រឡប់-1 🏠",
"露出敏感部位让对方亲吻或者抚摸 🏕️ / បង្ហាញតំបន់សំខាន់ឲ្យមនុស្សផ្សេងប៉ះឬបរិងសូត្រ 🏕️",
"女生在上面保持10分钟的性爱 🌇 / ស្ត្រីនៅលើ ធ្វើសកម្មភាពសេចក្តីស្នេហ៍ ១០ នាទី 🌇",
"被对方控制1分钟 🍽️ / ត្រូវអោយម្ចាស់ផ្ទាល់គ្រប់គ្រងរយៈពេល ១ នាទី 🍽️",
"亲亲+2 💏 / ប៉ះ +2 💏",
"在浴室里面做爱 🎬 / ជួបគ្នាក្នុងបន្ទប់ទឹក 🎬",
"含冰块亲吻对方敏感部位 🚴 / បារគ្រឿងកកស្រមុំត្រចៀកផ្នែកសំខាន់ 🚴",
"穿对方的衣服 / ស្លៀកអាវរបស់មនុស្សដទ",
"女生穿上性感的衣服 / ស្ត្រីស្លៀកសំលៀកបំពាក់ដែលទាក់ទាញ",
"舔对方耳朵30秒 / លាបក្រអូបកំណាត់ត្រចៀករបស់ម្ខាងទៀតរយៈពេល ៣០ វិនាទី",
"给对方化妆 / ជួយអ្នកដទៃធ្វើម៉េកអាប់",
"舌吻30秒 💏 / ថើបដោយអណ្តាត ៣០ វិនាទី 💏",
"互相看眼睛30s 👀 / មើលភ្នែកគ្នា30s 👀",
"随机脱一件对方的衣服 🎁 / ដោះសម្លៀកបំពាក់មួយឈុតរបស់គូស្នេហ៍ដោយចៃដន្យ 🎁",
"公主抱30秒 🍽️ / គូស្នេហ៍បែបព្រះនាង ៣០ វិនាទី 🍽️",
"深情亲吻对方胸口 30 秒 🚶‍♂️🚶‍♀️ / ស្និទ្ធស្នាលលើទ្រូងគូរបស់អ្នក ៣០ វិនាទី 🚶‍♂️🚶‍♀️",
"给对方喂水（嘴对嘴） 🎵 / ផឹកទឹកជាមួយគូរបស់អ្នក តាមមាត់តី 🎵",
"亲吻对方下体30秒 🎬 / មេត្តាជូបផ្នែកខាងក្រោមនៃរាងកាយរបស់អ្នកដទៃ ៣០ វិនាទី 🎬",
"打对方三下屁股 🍫 / ដាក់ដៃបីដងលើខ្នងខាងក្រោយរបស់មិត្តភក្តិ 💖",
"抱起对方亲吻30秒 🚴 / កាប់គូរបស់អ្នកឡើងហើយបង្រួមប吻រយៈពេល ៣០ វិនាទី 🚴",
"自由活动时间30分钟 / ពេលវេលារស់រាយសេរី ៣០ នាទី",
"再跳一次 🎲 / ដើរថ្មីម្តងទៀត 🎲",
"亲亲+2 💏 / ប៉ះ +2 💏",
"温柔抚摸30秒 🖐️ / ប៉ះសម្ងាត់រយៈពេល ៣០ វិនាទី 🖐️",
"互相拥抱一分钟 🤗 / ក្បាលស្និទ្ធរយៈពេល ១ នាទី 🤗",
"亲吻脸颊 💋 / ថើបមុខមាត់ 💋",
"给对方画眼线 🎨 / គូស្នេហ៍ធ្វើម៉េកអាប់ភ្នែក 🎨",
"互相抚摸背部30秒 💆 / ប៉ះខ្នងរយៈពេល ៣០ វិនាទី 💆",
"亲吻手指 💖 / ថើបដៃ 💖",
"游戏暂停30秒 ⏸️ / បញ្ឈប់ហ្គេម ៣០ វិនាទី ⏸️",
"深情对视10秒 👀 / មើលភ្នែកគ្នា ១០ វិនាទី 👀",
"给对方送小礼物 🎁 / ផ្តល់អំណោយតូច 🎁",
"拥抱跳舞15秒 💃 / រាំ និងស្និទ្ធ ១៥ វិនាទី 💃",
"互相搓手30秒 ✋ / លាបដៃរួមគ្នា ៣០ វិនាទី ✋",
"亲吻脚踝 💋 / ថើបបាតជើង 💋",
"轻拍背部 💆 / ប៉ះខ្នង 💆",
"再来一次 ✨ / ម្តងទៀត ✨",
"回家-1 🏠 / ត្រឡប់-1 🏠",
"亲亲+2 💏 / ប៉ះ +2 💏",
"自由选择动作30秒 🕒 / ជ្រើសរើសសកម្មភាពរយៈពេល ៣០ វិនាទី 🕒",
];  

// 创建棋盘和内容列表
for(let i=0;i<boardSize;i++){
  const cell = document.createElement('div');
  cell.className='cell';
  cell.id='cell-'+i;
  cell.textContent=i+1;
  board.appendChild(cell);

  const contentDiv = document.createElement('div');
  contentDiv.id='content-'+i;
  contentDiv.textContent = cellContents[i];
  contentList.appendChild(contentDiv);
}

// 更新棋盘显示
function updateBoard(){
  for(let i=0;i<boardSize;i++){
    const contentDiv = document.getElementById('content-'+i);
    if(i===playerPos[currentPlayer]){
      contentDiv.classList.add('active');
      contentDiv.scrollIntoView({behavior:'smooth', block:'center'});
    } else {
      contentDiv.classList.remove('active');
    }
  }

  for(let i=0;i<boardSize;i++){
    const cell = document.getElementById('cell-'+i);
    cell.innerHTML = i+1;
  }
  // 棋子
  if(playerPos[0]<boardSize){
    const p1 = document.createElement('div');
    p1.className='heart player1';
    p1.textContent='💖';
    document.getElementById('cell-'+playerPos[0]).appendChild(p1);
  }
  if(playerPos[1]<boardSize){
    const p2 = document.createElement('div');
    p2.className='heart player2';
    p2.textContent='💙';
    document.getElementById('cell-'+playerPos[1]).appendChild(p2);
  }
}

// 棋子移动动画
async function movePlayer(playerIndex, steps){
  moving=true;
  for(let s=0;s<steps;s++){
    playerPos[playerIndex] += 1;
    if(playerPos[playerIndex]>=boardSize) playerPos[playerIndex]=boardSize-1;
    updateBoard();
    await new Promise(r=>setTimeout(r,300));
  }
  // 检查特殊格
  if(specialCells[playerPos[playerIndex]]){
    const move = specialCells[playerPos[playerIndex]].move;
    if(move!==0){
      await movePlayer(playerIndex, move);
      // ✅ 用状态显示代替 alert
      status.textContent = specialCells[playerPos[playerIndex]].text;
    }
  }
  moving=false;
}

// 骰子转动动画
function rollDiceAnimation(){
  return new Promise(resolve=>{
    let count=0;
    const interval = setInterval(()=>{
      const r = Math.floor(Math.random()*6)+1;
      diceEl.textContent = '🎲 '+r;
      diceEl.style.transform = 'rotate('+Math.random()*360+'deg) scale(1.2)';
      count++;
      if(count>=10){
        clearInterval(interval);
        resolve(r);
      }
    },50);
  });
}

// 掷骰子逻辑
async function rollDice(){
  if(moving) return; 
  moving = true;
  clearTimeout(safetyTimer);
  safetyTimer = setTimeout(()=>{ moving = false; }, 3000); // 防卡死补丁

  const roll = await rollDiceAnimation();
  diceEl.textContent='🎲 '+roll;
  await movePlayer(currentPlayer, roll);

  if(playerPos[currentPlayer]>=boardSize){
    playerPos[currentPlayer]=boardSize-1;
    status.textContent = playerNames[currentPlayer]+'获胜！💖 / '+playerNames[currentPlayer]+' ឈ្នះ! 💖';
    playerPos=[0,0];
  }

  currentPlayer=1-currentPlayer;
  status.textContent = playerNames[currentPlayer]+'轮到 / អ្នកលេង'+(currentPlayer+1);
  updateBoard();
  moving=false;
}

// 开始游戏
startBtn.addEventListener('click', ()=>{
  const n1 = document.getElementById('name1').value.trim();
  const n2 = document.getElementById('name2').value.trim();
  if(n1) playerNames[0]=n1;
  if(n2) playerNames[1]=n2;
  playerPos=[0,0];
  currentPlayer=0;
  rollBtn.disabled=false;
  status.textContent = playerNames[currentPlayer]+'轮到 / អ្នកលេង'+(currentPlayer+1);
  updateBoard();
});

rollBtn.addEventListener('click', rollDice);
updateBoard();
</script>

</body>
</html>
