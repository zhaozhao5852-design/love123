<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>情侣飞行棋 💖🧩</title>
<style>
body {
  font-family: sans-serif;
  margin:0;
  padding:20px;
  background:#fff0f5;
  display:flex;
  flex-direction:column;
  align-items:center;
}
h1 {
  color:#ff69b4;
  text-align:center;
}
#gameContainer {
  display:flex;
  gap:20px;
  flex-wrap:wrap;
  justify-content:center;
}
#board {
  display:grid;
  grid-template-columns:repeat(10,40px);
  grid-gap:2px;
}
.cell {
  width:40px;
  height:40px;
  border:1px solid #ccc;
  display:flex;
  justify-content:center;
  align-items:center;
  position:relative;
  font-size:12px;
  border-radius:4px;
  background:#ffe6f0;
}
.heart {
  width:30px;
  height:30px;
  border-radius:50%;
  display:flex;
  justify-content:center;
  align-items:center;
  color:white;
  font-weight:bold;
  position:absolute;
  top:5px;
  left:5px;
  transition: transform 0.3s ease;
}
.player1 { background-color:#ff69b4; }
.player2 { background-color:#87cefa; }
#rightPanel {
  display:flex;
  flex-direction:column;
  width:240px;
}
#contentList {
  flex:1;
  overflow-y:auto;
  background:white;
  border-radius:5px;
  padding:5px;
  box-shadow:1px 1px 5px rgba(0,0,0,0.1);
  max-height:420px;
}
#contentList div {
  padding:2px 5px;
  font-size:12px;
  color:#333;
  display:none;
}
#contentList div.active {
  display:block;
  background:#ffb6c1;
  border-radius:3px;
}
#diceArea { 
  width:50px; 
  height:50px; 
  margin:5px auto; 
  perspective:600px; 
}
#dice { 
  width:50px; 
  height:50px; 
  position:relative; 
  transform-style:preserve-3d; 
  transition: transform 0.2s ease; 
  cursor:pointer;
}
#dice:active { 
  transform: translateY(5px) scale(0.95); 
}
.face { 
  position:absolute; 
  width:50px; 
  height:50px; 
  background:#fff; 
  border:2px solid #ff1493; 
  border-radius:6px;
  display:flex; 
  flex-wrap:wrap; 
  justify-content:space-around; 
  align-content:space-around;
  box-shadow:1px 1px 5px rgba(0,0,0,0.3); 
}
.dot { 
  width:8px; 
  height:8px; 
  background:#ff1493; 
  border-radius:50%; 
}
.face1 { transform:rotateY(0deg) translateZ(25px); }
.face2 { transform:rotateY(180deg) translateZ(25px); }
.face3 { transform:rotateX(90deg) translateZ(25px); }
.face4 { transform:rotateX(-90deg) translateZ(25px); }
.face5 { transform:rotateY(90deg) translateZ(25px); }
.face6 { transform:rotateY(-90deg) translateZ(25px); }
#diceNumber {
  text-align:center;
  margin-top:5px;
  font-size:18px;
  font-weight:bold;
}
#playerNames { margin-bottom:10px; text-align:center; }
input { padding:4px 6px; margin:0 5px; border-radius:4px; border:1px solid #ccc; width:80px; }
#status { margin-top:5px; font-size:14px; color:#333; }
button {
  padding:8px 16px;
  margin:5px 0;
  border:none;
  border-radius:5px;
  background:#ff69b4;
  color:white;
  cursor:pointer;
  width:100%;
}
</style>
</head>
<body>

<h1>情侣飞行棋 💖🧩<br>ល្បែងហ្គេមហោះគូស្នេហ៍</h1>

<div id="playerNames">
玩家1昵称: <input id="name1" placeholder="💖Ta1">
玩家2昵称: <input id="name2" placeholder="💙Ta2">
<button id="startBtn">开始游戏 / ចាប់ផ្តើមហ្គេម</button>
</div>

<div id="gameContainer">
  <div id="board"></div>
  <div id="rightPanel">
    <div id="contentList"></div>
    <div id="diceContainer">
      <button id="rollBtn" disabled>掷骰子 🎲 / ដាក់គ្រាប់ចាញ់ 🎲</button>
      <div id="diceArea">
        <div id="dice">
          <div class="face face1"><div class="dot"></div></div>
          <div class="face face2"><div class="dot"></div><div class="dot"></div></div>
          <div class="face face3"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
          <div class="face face4"><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
          <div class="face face5"><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
          <div class="face face6"><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
        </div>
      </div>
      <div id="diceNumber">点数: 🎲</div>
      <div id="status"></div>
    </div>
  </div>
</div>

<script>
// 初始化
const boardSize = 100;
const board = document.getElementById('board');
const contentList = document.getElementById('contentList');
const status = document.getElementById('status');
const dice = document.getElementById('dice');
const diceNumberEl = document.getElementById('diceNumber');
const rollBtn = document.getElementById('rollBtn');
const startBtn = document.getElementById('startBtn');

let playerPos = [0,0];
let currentPlayer = 0;
let playerNames = ["玩家1","玩家2"];
let moving = false;
let safetyTimer = null;

// 特殊格子
const specialCells = {
  5: {type:'kiss', text:'亲亲+2 💏 / ប៉ះ +2 💏', move:2},
  12:{type:'home', text:'回家-1 🏠 / ត្រឡប់-1 🏠', move:-1},
  23:{type:'kiss', text:'亲亲+2 💏 / ប៉ះ +2 💏', move:2},
  37:{type:'home', text:'回家-1 🏠 / ត្រឡប់-1 🏠', move:-1},
  50:{type:'kiss', text:'亲亲+2 💏 / ប៉ះ +2 💏', move:2},
  70:{type:'home', text:'回家-1 🏠 / ត្រឡប់-1 🏠', move:-1},
  85:{type:'kiss', text:'亲亲+2 💏 / ប៉ះ +2 💏', move:2}
};

// 棋盘内容
let cellContents = [
"脱掉两件衣服🌸 / ដោះខោអាវពីរ💖",
"亲对方手 ✋ / ថើបដៃគូរបស់អ្នក ✋",
"甜蜜拥抱 🤗 / ក្បាលស្និទ្ធ 🤗",
"舌吻30秒 💏 / ថើបដោយអណ្តាត ៣០ វិនាទី 💏",
"互相看眼睛30s 👀 / មើលភ្នែកគ្នា30s 👀",
"随机脱一件对方的衣服 🎁 / ដោះសម្លៀកបំពាក់មួយឈុតរបស់គូស្នេហ៍ដោយចៃដន្យ 🎁",
"公主抱30秒 🍽️ / គូស្នេហ៍បែបព្រះនាង ៣០ វិនាទី 🍽️",
"深情亲吻对方胸口 30 秒 🚶‍♂️🚶‍♀️ / ស្និទ្ធស្នាលលើទ្រូងគូរបស់អ្នក ៣០ វិនាទី 🚶‍♂️🚶‍♀️",
"给对方喂水（嘴对嘴） 🎵 / ផឹកទឹកជាមួយគូរបស់អ្នក តាមមាត់តី 🎵",
"亲吻对方下体30秒 🎬 / មេត្តាជូបផ្នែកខាងក្រោមនៃរាងកាយរបស់អ្នកដទៃ ៣០ វិនាទី 🎬",
"打对方三下屁股 🍫 / ដាក់ដៃបីដងលើខ្នងខាងក្រោយរបស់មិត្តភក្តិ 💖",
"亲亲+2 💏 / ប៉ះ +2 💏",
"抱起对方亲吻30秒 🚴 / កាប់គូរបស់អ្នកឡើងហើយបង្រួមប吻រយៈពេល ៣០ វិនាទី 🚴",
"观看性爱视频，并进行10分钟的性爱 🌇 / មើលវីដេអូភេទរួមគ្នា ហើយធ្វើសេចក្តីស្នេហ៍រយៈពេល ១០ នាទី 🌇",
"回家-1 🏠 / ត្រឡប់-1 🏠",
"亲吻对方脖子到胸口 🐱 / លីកកករ និងទ្រូងរបស់ម្នាក់រយៈ ៣០ វិនាទី 🐱",
"脱掉两件衣服 🐶 / ដកអាវពីរ 🐶",
"想办法让对方下体流水 🏖️ / រកវិធីដើម្បីធ្វើឱ្យចំណង់ផ្លូវភេទរបស់មនុស្សផ្សេងទៀតហូរចេញពីរាងកាយខាងក្រោម 🏖️",
"给对方按摩1分钟 🎈 / អ្នកប្រគល់ម៉ាស្សាទៅអ្នករយៈពេល ១ នាទី 🎈",
"亲亲+2 💏 / ប៉ះ +2 💏",
"互相舔对方下体1分钟 🌅 / លិបរាងកាយផ្នែកខាងក្រោមរបស់គ្នាទៅវិញទៅមករយៈពេល 1 នាទី 🌅",
"休息一分钟 📚 / សម្រាក 1 នាទី 📚",
"回家-1 🏠 / ត្រឡប់-1 🏠",
"跳舞30秒 💃 / រាំ ៣០ វិនាទី 💃",
"女生用脚和对方发生性行为 🎡 / ស្រ្តីប្រើជើងរបស់ខ្លួនឲ្យមនុស្សម្នាក់ទទួលការទាក់ទងផ្លូវភេទ 🎡",
"温馨拥抱30s 🤗 / ក្បាលស្និទ្ធ 30s 🤗",
"和对方一起洗澡 🎨 / ងូតទឹកជាមួយនរណាម្នាក់ 🎨",
"亲亲+2 💏 / ប៉ះ +2 💏",
"骑在对方身上30s 🐎 / ជិះលើរាងកាយអ្នកដទៃរយៈពេល ៣០ វិនាទី 🐎",
"一分钟比赛任何事情 🛹 / ប្រកួតប្រជែងគ្នា ១ នាទី 🛹",
"再来一次 ✨ / ម្តងទៀត ✨",
"停止行动30秒 🎁 / បញ្ឈប់សកម្មភាព ៣០ វិនាទី 🎁",
"亲亲+2 💏 / ប៉ះ +2 💏",
"让对方高潮 ☕ / ធ្វើឱ្យម្នាក់ទទួលបានកំពូលសេចក្តីសុខ ☕",
"亲吻对方屁股30秒 ✈️ / ហែលទឹកបារីរបស់គ្នាទៅរយៈពេល ៣០ វិនាទី ✈️",
"回家-1 🏠 / ត្រឡប់-1 🏠",
"露出敏感部位让对方亲吻或者抚摸 🏕️ / បង្ហាញតំបន់សំខាន់ឲ្យមនុស្សផ្សេងប៉ះឬបរិងសូត្រ 🏕️",
"女生在上面保持10分钟的性爱 🌇 / ស្ត្រីនៅលើ ធ្វើសកម្មភាពសេចក្តីស្នេហ៍ ១០ នាទី 🌇",
"被对方控制1分钟 🍽️ / ត្រូវអោយម្ចាស់ផ្ទាល់គ្រប់គ្រងរយៈពេល ១ នាទី 🍽️",
"亲亲+2 💏 / ប៉ះ +2 💏",
"在浴室里面做爱 🎬 / ជួបគ្នានៅក្នុងបន្ទប់ទឹក 🎬",
"含冰块亲吻对方敏感部位 🚴 / បារគ្រឿងកកស្រមុំត្រចៀកផ្នែកសំខាន់ 🚴",
"穿对方的衣服 / ស្លៀកអាវរបស់មនុស្សដទៃ",
"女生穿上性感的衣服 / ស្ត្រីស្លៀកសំលៀកបំពាក់ដែលទាក់ទាញ",
"舔对方耳朵30秒 / លាបក្រអូបកំណាត់ត្រចៀករបស់ម្ខាងទៀតរយៈពេល ៣០ វិនាទី",
"给对方化妆 / ជួយអ្នកដទៃធ្វើម៉េកអាប់",
"舌吻30秒 💏 / ថើបដោយអណ្តាត ៣០ វិនាទី 💏",
"互相看眼睛30s 👀 / មើលភ្នែកគ្នា30s 👀",
"随机脱一件对方的衣服 🎁 / ដោះសម្លៀកបំពាក់មួយឈុតរបស់គូស្នេហ៍ដោយចៃដន្យ 🎁",
"公主抱30秒 🍽️ / គូស្នេហ៍បែបព្រះនាង ៣០ វិនាទី 🍽️",
"深情亲吻对方胸口 30 秒 🚶‍♂️🚶‍♀️ / ស្និទ្ធស្នាលលើទ្រូងគូរបស់អ្នក ៣០ វិនាទី 🚶‍♂️🚶‍♀️",
"给对方喂水（嘴对嘴） 🎵 / ផឹកទឹកជាមួយគូរបស់អ្នក តាមមាត់តី 🎵",
"亲吻对方下体30秒 🎬 / មេត្តាជូបផ្នែកខាងក្រោមនៃរាងកាយរបស់អ្នកដទៃ ៣០ វិនាទី 🎬",
"打对方三下屁股 🍫 / ដាក់ដៃបីដងលើខ្នងខាងក្រោយរបស់មិត្តភក្តិ 💖",
"抱起对方亲吻30秒 🚴 / កាប់គូរបស់អ្នកឡើងហើយបង្រួមប吻រយៈពេល ៣០ វិនាទី 🚴",
"自由活动时间30分钟 / ពេលវេលារស់រាយសេរី ៣០ នាទី",
"再跳一次 🎲 / ដើរថ្មីម្តងទៀត 🎲",
"亲亲+2 💏 / ប៉ះ +2 💏",
"温柔抚摸30秒 🖐️ / ប៉ះសម្ងាត់រយៈពេល ៣០ វិនាទី 🖐️",
"互相拥抱一分钟 🤗 / ក្បាលស្និទ្ធរយៈពេល ១ នាទី 🤗",
"亲吻脸颊 💋 / ថើបមុខមាត់ 💋",
"给对方画眼线 🎨 / គូស្នេហ៍ធ្វើម៉េកអាប់ភ្នែក 🎨",
"互相抚摸背部30秒 💆 / ប៉ះខ្នងរយៈពេល ៣០ វិនាទី 💆",
"亲吻手指 💖 / ថើបដៃ 💖",
"游戏暂停30秒 ⏸️ / បញ្ឈប់ហ្គេម ៣០ វិនាទី ⏸️",
"深情对视10秒 👀 / មើលភ្នែកគ្នា ១០ វិនាទី 👀",
"给对方送小礼物 🎁 / ផ្តល់អំណោយតូច 🎁",
"拥抱跳舞15秒 💃 / រាំ និងស្និទ្ធ ១៥ វិនាទី 💃",
"互相搓手30秒 ✋ / លាបដៃរួមគ្នា ៣០ វិនាទី ✋",
"亲吻脚踝 💋 / ថើបបាតជើង 💋",
"轻拍背部 💆 / ប៉ះខ្នង 💆",
"再来一次 ✨ / ម្តងទៀត ✨",
"回家-1 🏠 / ត្រឡប់-1 🏠",
"亲亲+2 💏 / ប៉ះ +2 💏",
"轻轻抚摸头发 30秒 🌸 / លាបសក់យ៉ាងស្រួល ៣០ វិនាទី 🌸",
"互相喂水果 🍓 / ផឹកផ្លែឈើជាមួយគ្នា 🍓",
"拥抱旋转10秒 💃 / ក្បាលស្និទ្ធបង្វិល ១០ វិនាទី 💃",
"手牵手走动30秒 🤝 / ចាប់ដៃដើរជាមួយគ្នា ៣០ វិនាទី 🤝",
"给对方讲笑话 😂 / ប្រាប់កំប្លែងឲ្យគូស្នេហ៍ 😂",
"一起唱歌 🎤 / អ្នកទាំងពីរច្រៀងផង 🎤",
"亲吻肩膀 10秒 💏 / ថើបស្មា ១០ វិនាទី 💏",
"互相拍照留念 📸 / ថតរូបជាមួយគ្នា 📸",
"拥抱并旋转跳舞15秒 💃 / ក្បាលស្និទ្ធ និងរាំបង្វិល ១៥ វិនាទី 💃",
"轻轻搓手心 30秒 ✋ / លាបដៃរួមគ្នា ៣០ វិនាទី ✋",
"给对方讲心里话 💌 / ពិភាក្សាថ្ងៃចិត្តទៅគ្នា 💌",
"互相摸耳朵10秒 👂 / លាបត្រចៀកគ្នា ១០ វិនាទី 👂",
"玩小小游戏1分钟 🎲 / លេងហ្គេមតូច ១ នាទី 🎲",
"互相拥抱30秒 🤗 / ក្បាលស្និទ្ធ ៣០ វិនាទី 🤗",
"亲吻手背 10秒 💖 / ថើបដៃខាងក្រោយ ១០ វិនាទី 💖",
"互相击掌5次 ✋ / ចាប់ដៃគ្នា ៥ ដង ✋",
"给对方送小心意 🎁 / ផ្តល់អំណោយតូច 💝",
"一起跳舞20秒 💃 / រាំជាមួយគ្នា ២០ វិនាទី 💃",
"手指相扣 30秒 🤝 / ចាប់ម្រាមដៃ ៣០ វិនាទី 🤝",
"自由选择动作30秒 🕒 / ជ្រើសរើសសកម្មភាពរយៈពេល ៣០ វិនាទី 🕒"
];

// 创建棋盘和内容列表
for(let i=0;i<boardSize;i++){
  const cell=document.createElement('div');
  cell.className='cell';
  cell.id='cell-'+i;
  cell.textContent=i+1;
  board.appendChild(cell);

  const contentDiv=document.createElement('div');
  contentDiv.id='content-'+i;
  contentDiv.textContent = cellContents[i];
  contentList.appendChild(contentDiv);
}

// 更新棋盘显示
function updateBoard(){
  for(let i=0;i<boardSize;i++){
    const contentDiv = document.getElementById('content-'+i);
    if(i===playerPos[currentPlayer]){
      contentDiv.classList.add('active');
      contentDiv.scrollIntoView({behavior:'smooth', block:'center'});
    } else contentDiv.classList.remove('active');

    const cell = document.getElementById('cell-'+i);
    cell.innerHTML = i+1;
    cell.querySelectorAll('.heart').forEach(h=>h.remove());
  }
  if(playerPos[0]<boardSize){
    const p1=document.createElement('div');
    p1.className='heart player1';
    p1.textContent='💖';
    document.getElementById('cell-'+playerPos[0]).appendChild(p1);
  }
  if(playerPos[1]<boardSize){
    const p2=document.createElement('div');
    p2.className='heart player2';
    p2.textContent='💙';
    document.getElementById('cell-'+playerPos[1]).appendChild(p2);
  }
}

// 棋子移动动画（循环版）
async function movePlayer(playerIndex, steps){
  moving=true;
  for(let s=0;s<steps;s++){
    playerPos[playerIndex]++;
    if(playerPos[playerIndex]>=boardSize){
      playerPos[playerIndex]=boardSize-1;
      updateBoard();
      break;
    }
    updateBoard();
    await new Promise(r=>setTimeout(r,200));
  }

  // 特殊格子处理（循环代替递归）
  let loopSafety=0;
  while(specialCells[playerPos[playerIndex]] && loopSafety<10){
    const move = specialCells[playerPos[playerIndex]].move;
    if(move!==0){
      status.textContent = specialCells[playerPos[playerIndex]].text;
      await new Promise(r=>setTimeout(r,500));
      for(let s=0;s<Math.abs(move);s++){
        playerPos[playerIndex] += move>0 ? 1 : -1;
        if(playerPos[playerIndex]<0) playerPos[playerIndex]=0;
        if(playerPos[playerIndex]>=boardSize) playerPos[playerIndex]=boardSize-1;
        updateBoard();
        await new Promise(r=>setTimeout(r,200));
      }
    } else break;
    loopSafety++;
  }
  moving=false;
}

// 3D骰子动画
function rollDiceAnimation(){
  return new Promise(resolve=>{
    const result = Math.floor(Math.random()*6)+1;
    let duration=2000, start=null;
    let randomX=Math.random()*360, randomY=Math.random()*360;

    const finalAnglesMap={1:[0,0],2:[0,180],3:[-90,0],4:[90,0],5:[0,-90],6:[0,90]};

    function animate(timestamp){
      if(!start) start=timestamp;
      let elapsed=timestamp-start;
      let progress=Math.min(elapsed/duration,1);
      let ease=progress<0.5 ? 4*progress*progress*progress : 1-Math.pow(-2*progress+2,3)/2;
      let bounce=Math.sin(progress*Math.PI)*8;
      let rotX=ease*1440 + randomX;
      let rotY=ease*1440 + randomY;
      dice.style.transform=`translateY(${-bounce}px) rotateX(${rotX}deg) rotateY(${rotY}deg)`;
      if(progress<1) requestAnimationFrame(animate);
      else{
        const finalAngles=finalAnglesMap[result];
        dice.style.transform=`translateY(0px) rotateX(${finalAngles[0]}deg) rotateY(${finalAngles[1]}deg)`;
        diceNumberEl.textContent='点数: '+result+' / ចំនួន: '+result;
        resolve(result);
      }
    }
    requestAnimationFrame(animate);
  });
}

// 掷骰子逻辑
async function rollDice(){
  if(moving) return;
  moving=true;
  clearTimeout(safetyTimer);
  safetyTimer=setTimeout(()=>{moving=false;},5000);

  const roll=await rollDiceAnimation();
  await movePlayer(currentPlayer,roll);

  if(playerPos[currentPlayer]>=boardSize-1){
    status.textContent = playerNames[currentPlayer]+'获胜！💖 / '+playerNames[currentPlayer]+' ឈ្នះ! 💖';
    playerPos=[0,0];
    updateBoard();
    moving=false;
    rollBtn.disabled=true;
    return;
  }

  currentPlayer=1-currentPlayer;
  status.textContent = playerNames[currentPlayer]+'轮到 / អ្នកលេង'+(currentPlayer+1);
  updateBoard();
  moving=false;
}

// 开始游戏
startBtn.addEventListener('click', ()=>{
  const n1 = document.getElementById('name1').value.trim();
  const n2 = document.getElementById('name2').value.trim();
  if(n1) playerNames[0]=n1;
  if(n2) playerNames[1]=n2;
  playerPos=[0,0];
  currentPlayer=0;
  rollBtn.disabled=false;
  status.textContent = playerNames[currentPlayer]+'轮到 / អ្នកលេង'+(currentPlayer+1);
  updateBoard();
});
rollBtn.addEventListener('click', rollDice);

updateBoard();
</script>
</body>
</html>
